# Cache
cache:
  directories:
  - vendor

branches:
  only:
  - master
  
# Prepare build
before_install:
  - chmod +x ./scripts/travis/server.sh ./scripts/travis/ui.sh ./scripts/travis/after_success.sh

install:
  - pip install --user codecov

before_script: true

matrix:
  include:
  #######################
  ## test-php-min
  #######################
  - language: php
    env: test-php-min
    php: 7.0
    script: "./scripts/travis/server.sh"
  #######################
  ## test-php-stable
  #######################
  - language: php
    env: test-php-stable
    php: 7.0.10
    script: "./scripts/travis/server.sh"
    # Only run after_success once with PHP version considered stable
    after_success:
      - "./scripts/travis/after_success.sh"
  #######################
  ## test-npm-min
  #######################
  - language: node_js
    env: test-npm-min
    node_js: 6.0.0
    script: "./scripts/travis/ui.sh"
  #######################
  ## test-npm-stable
  #######################
  - language: node_js
    env: test-npm-stable
    node_js: 6.7.0
    script: "./scripts/travis/ui.sh"
    # Only run after_success once with PHP version considered stable
    after_success:
      - "./scripts/travis/after_success.sh"
  #######################
  ## deploy-release
  #######################
  - language: node_js
    env: deploy-release
    script:
      - export TOOLSHEDR_LAST_COMMIT=`git log --format=fuller -1`
      - export TOOLSHEDR_LAST_RELEASE=`git describe --abbrev=0 --tags`
    deploy: 
      node_js: 6.7.0 
      on:
        tags: true
        all_branches: true
        repo: mkungla/toolshedr
      provider: npm
      email: marko.kungla@gmail.com
      api_key:
        secure: kGU5QYsRFn9cfVUZbZKBWjf5fsUaY1K6eQFWM0xLaCFHklnGUW+snhmC+yYFRspeaSpZBVLI4PiFvwT6NDBeczK3E/LGdccAVM3XHSDDKOIqpSibbsN0MWUdtgalfn10ODhVqx+o0P0jBp3qxoEKqr9I3A5WyDqP6zo8fATYFZqm62DjS33B+dl9s4nHQwLyL27P4k8npJJgQgUWN+RHzEt2Gsj4o4R6wAgBvrLtuKSKd4hkCNDHS20wLtt/COuRE4oRrTFBNS50mFbQPey3OjeKJunNHP/+KiZf4+U3JgZZhkajkYSXznAj+0/fBxppgsFz83hdEMmNftYNsAz2JMHb4yWr7AQdN4SaXzRosVAnaEPBrm5NSTMGApoKxnl9SLXUX6d06xOgJEOGdZcoHAIziY2SQav+7OwShFZiAngwIygZkSaVQ5TLWvxL5yfayIl7j/fkENXEF6UQ/Y68C6hIjIfUZuZxpnNUc1NrnXLiSi61eP/NyXWGuukZ2u5H2WS08AZyrifVpGLXYURLQ4C+4xy3+JUFAozUdzUZ/EOcmg7eg+jDEfc54TYgHeummT4A91Ux+YyPulmEmqR9o7P9CTZdPkXtU/i1ORum8f0ox4t1csIg3UDI1rLp1RaycA+lgh6HS1/L5+MP/qS4EnpeYpl5hbIka/7hOouTMr4=
